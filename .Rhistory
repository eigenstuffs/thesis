library(tidytext)
library(text2vec)
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(ggplot2)
library(tm)
library(SnowballC)
library(tidyr)
library(tidytext)
library(syuzhet)
library(topicmodels)
library(readtext)
library(stringr)
library(tidytext)
library(quanteda)
head(tf_idf, 15) %>%
group_by(`Clothing ID`) %>%
slice_max(tf_idf, n = 50) %>%
ungroup() %>%
ggplot(aes(tf_idf, fct_reorder(word, tf_idf), fill = `Clothing ID`)) + geom_col(show.legend=FALSE)
install.packages("forcats")
library(forcats)
head(tf_idf, 15) %>%
group_by(`Clothing ID`) %>%
slice_max(tf_idf, n = 50) %>%
ungroup() %>%
ggplot(aes(tf_idf, fct_reorder(word, tf_idf), fill = `Clothing ID`)) + geom_col(show.legend=FALSE)
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(ggplot2)
library(tm)
library(SnowballC)
library(tidyr)
library(tidytext)
library(syuzhet)
library(topicmodels)
library(readtext)
library(stringr)
library(tidytext)
library(quanteda)
library(forcats)
wcr <- read_csv("WCR.csv")
dim(wcr)
summary(wcr[,c("Age", "Rating", "Recom.Status", "Division Name", "Positive Feedback Count", "Department Name", "Class Name")])
corpus <- Corpus(VectorSource(wcr$`Review Text`))
dtm <- DocumentTermMatrix(corpus)
inspect(dtm[1:5, 1:5])
findFreqTerms(dtm, lowfreq = 1500, highfreq = Inf)
findAssocs(dtm, terms="dress", .1)
freq <- colSums(as.matrix(dtm))
head(sort(freq, decreasing = TRUE), 15)
recommended_indices <- wcr$Recom.Status == "Recommended"
word_freq_recommended <- colSums(as.matrix(dtm[recommended_indices, ]))
word_freq_not_recommended <- colSums(as.matrix(dtm[!recommended_indices, ]))
head(sort(word_freq_recommended, decreasing = TRUE), 15)
head(sort(word_freq_not_recommended, decreasing = TRUE), 15)
tidy_wcr <- wcr %>% unnest_tokens(word, `Review Text`) %>% anti_join(stop_words)
review <- tidy_wcr %>% count(`Clothing ID`, word, sort = TRUE)
tf_idf <- review %>% bind_tf_idf(word, `Clothing ID`, n) %>% arrange(desc(tf_idf))
head(tf_idf)
tidy_wcr_two <- wcr %>% filter(Recom.Status == "Recommended") %>% unnest_tokens(word, `Review Text`) %>% anti_join(stop_words)
review_words_two <- tidy_wcr_two %>% count(`Clothing ID`, word, sort = TRUE)
tf_idf_scores_two <- review_words_two %>% bind_tf_idf(word, `Clothing ID`, n) %>% arrange(desc(tf_idf))
head(tf_idf_scores_two)
tidy_wcr_three <- wcr %>% filter(Recom.Status == "Not Recommended") %>% unnest_tokens(word, `Review Text`) %>% anti_join(stop_words)
review_words_three <- tidy_wcr_three %>% count(`Clothing ID`, word, sort = TRUE)
tf_idf_scores_three <- review_words_three %>% bind_tf_idf(word, `Clothing ID`, n) %>% arrange(desc(tf_idf))
head(tf_idf_scores_three)
head(tf_idf, 15) %>%
group_by(`Clothing ID`) %>%
slice_max(tf_idf, n = 50) %>%
ungroup() %>%
ggplot(aes(tf_idf, fct_reorder(word, tf_idf), fill = `Clothing ID`)) + geom_col(show.legend=FALSE)
bing <- get_sentiments("bing")
afinn <- get_sentiments("afinn")
wcr_bing <- tidy_wcr %>% inner_join(bing) %>% count(word, sort = TRUE)
wcr_afinn <- tidy_wcr %>% inner_join(afinn) %>% count(word, sort = TRUE)
head(wcr_bing)
head(wcr_afinn)
tf_idf_scores_four <- tf_idf %>% inner_join(wcr, by = "Clothing ID")
head(arrange(tf_idf_scores_four, desc(Rating)), 4)
wcr_dtm_2 <- tidy_wcr %>% count(`Clothing ID`, word) %>% cast_dtm(`Clothing ID`, word, n)
wcr_LDA <- LDA(wcr_dtm_2, k = 3, control = list(seed = 1128))
wcr_LDA
wcr_beta <- tidy(wcr_LDA, matrix = "beta")
wcr_beta
wcr_gamma <- tidy(wcr_LDA, matrix = "gamma")
wcr_gamma
top_terms_beta <- wcr_beta %>%
group_by(topic) %>%
top_n(10, beta) %>%
ungroup() %>%
arrange(topic, -beta)
top_terms_beta
top_terms_gamma <- wcr_gamma %>%
group_by(topic) %>%
top_n(10, gamma) %>%
ungroup() %>%
arrange(topic, -gamma)
top_terms_gamma
top_terms_beta <- wcr_beta %>%
group_by(topic) %>%
top_n(10, beta) %>%
ungroup() %>%
arrange(topic, -beta)
top_terms_beta
top_terms_gamma <- wcr_gamma %>%
group_by(topic) %>%
top_n(10, gamma) %>%
ungroup() %>%
arrange(topic, -gamma)
top_terms_gamma
top_terms_gamma <- wcr_gamma %>%
group_by(topic) %>%
top_n(10, gamma) %>%
ungroup() %>%
arrange(topic, -gamma)
top_terms_gamma
top_terms_beta <- wcr_beta %>%
group_by(topic) %>%
top_n(10, beta) %>%
ungroup() %>%
arrange(topic, -beta)
top_terms_beta
wcr_beta <- tidy(wcr_LDA, matrix = "beta")
wcr_beta
wcr_gamma <- tidy(wcr_LDA, matrix = "gamma")
wcr_gamma
wcr_beta
wcr_gamma
ggplot(top_terms_beta) + geom_histogram(aes(x=term))
ggplot(top_terms_beta) + geom_histogram(aes(x=term), stat="count")
top_terms_gamma
head(top_terms_gamma)
ggplot(top_terms_beta) + geom_histogram(aes(x=gamma), stat="count")
ggplot(top_terms_gamma) + geom_histogram(aes(x=gamma), stat="count")
head(top_terms_gamma)
wcr_beta
options(scipen=999)
library(tidyverse)
library(patchwork)
library(jtools)
library(stringr)
library(car)
library(ggpubr)
library(fixest)
library(lmtest)
library(xtable)
library(sandwich)
library(multiwayvcov)
set.seed(07151129)
theme_set(theme_pubr())
panel <- read.csv("panel_with_count_FEB20.csv")
permutation_coefficients <- data.frame(Emissions = rep(NA, 1000),
CarbonIntensity = rep(NA, 1000),
EnergyIntensity = rep(NA, 1000),
PolicyScore = rep(NA, 1000),
CIScore = rep(NA, 1000),
EIScore = rep(NA, 1000))
m1 <- feols(
data = panel,
fml = log(CarbonIntensity) ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
m2 <- feols(
data = panel,
fml = log(EnergyIntensity) ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
residuals_m1 <- resid(m1)
residual_threshold_m1 <- mean(residuals_m1) + 2*sd(residuals_m1)
observations_to_exclude_m1 <- which(abs(residuals_m1) > residual_threshold_m1)
data_reduced_m1 <- panel[-observations_to_exclude_m1, ]
residuals_m2 <- resid(m2)
residual_threshold_m2 <- mean(residuals_m2) + 2*sd(residuals_m2)
observations_to_exclude_m2 <- which(abs(residuals_m2) > residual_threshold_m2)
data_reduced_m2 <- panel[-observations_to_exclude_m2, ]
m1_no_outliers <- feols(
data = data_reduced_m1,
fml = log(CarbonIntensity) ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
m2_no_outliers <- feols(
data = data_reduced_m2,
fml = log(EnergyIntensity) ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
m1
m2
m1_no_outliers
m2_no_outliers
m3 <- feols(
data = panel,
fml = log(CarbonIntensity) ~ Ideology + log(GDPPerCapita) + log(Population) +
Weighted_GHI + Weighted_Speed120m + PercentUrban + PropManuEmployment +
PropFarmEmployment,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
m4 <- feols(
data = panel,
fml = log(EnergyIntensity) ~ Ideology + log(GDPPerCapita) + log(Population) +
Weighted_GHI + Weighted_Speed120m + PercentUrban + PropManuEmployment +
PropFarmEmployment,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
residuals_m3 <- resid(m3)
residual_threshold_m3 <- mean(residuals_m3) + 2*sd(residuals_m3)
observations_to_exclude_m3 <- which(abs(residuals_m3) > residual_threshold_m3)
data_reduced_m3 <- panel[-observations_to_exclude_m3, ]
residuals_m4 <- resid(m4)
residual_threshold_m4 <- mean(residuals_m4) + 2*sd(residuals_m4)
observations_to_exclude_m4 <- which(abs(residuals_m4) > residual_threshold_m4)
data_reduced_m4 <- panel[-observations_to_exclude_m4, ]
m3_no_outliers <- feols(
data = data_reduced_m3,
fml = log(CarbonIntensity) ~ Ideology + log(GDPPerCapita) + log(Population) +
Weighted_GHI + Weighted_Speed120m + PercentUrban + PropManuEmployment +
PropFarmEmployment,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
m4_no_outliers <- feols(
data = data_reduced_m4,
fml = log(EnergyIntensity) ~ Ideology + log(GDPPerCapita) + log(Population) +
Weighted_GHI + Weighted_Speed120m + PercentUrban + PropManuEmployment +
PropFarmEmployment,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
m3
m4
m3_no_outliers
m4_no_outliers
baseline_emissions <- feols(
data = panel,
fml = log(EmissionsPerCapita) ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
coef_emissions <- coef(baseline_emissions)["Ideology"]
for(i in 1:1000) {
shuffled_data <- panel %>%
group_by(State) %>%
mutate(
order = row_number(),
shift = sample(1:n(), 1),
Ideology = Ideology[(order - shift) %% n() + 1]
) %>%
ungroup()
model <- feols(
data = shuffled_data,
fml = log(EmissionsPerCapita) ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
permutation_coefficients$Emissions[i] <- coef(model)["Ideology"]
}
baseline_carbon <- feols(
data = panel,
fml = log(CarbonIntensity) ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
coef_carbon <- coef(baseline_carbon)["Ideology"]
for(i in 1:1000) {
shuffled_data <- panel %>%
group_by(State) %>%
mutate(
order = row_number(),
shift = sample(1:n(), 1),
Ideology = Ideology[(order - shift) %% n() + 1]
) %>%
ungroup()
model <- feols(
data = shuffled_data,
fml = log(CarbonIntensity) ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
permutation_coefficients$CarbonIntensity[i] <- coef(model)["Ideology"]
}
baseline_energy <- feols(
data = panel,
fml = log(EnergyIntensity) ~ Ideology + log(Population) + log(GDPPerCapita)| State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
coef_energy <- coef(baseline_energy)["Ideology"]
for(i in 1:1000) {
shuffled_data <- panel %>%
group_by(State) %>%
mutate(
order = row_number(),
shift = sample(1:n(), 1),
Ideology = Ideology[(order - shift) %% n() + 1]
) %>%
ungroup()
model <- feols(
data = shuffled_data,
fml = log(EnergyIntensity) ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
permutation_coefficients$EnergyIntensity[i] <- coef(model)["Ideology"]
}
baseline_policies <- feols(
data = panel,
fml = Score ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
coef_policies <- coef(baseline_policies)
for(i in 1:1000) {
shuffled_data <- panel %>%
group_by(State) %>%
mutate(
order = row_number(),
shift = sample(1:n(), 1),
Ideology = Ideology[(order - shift) %% n() + 1]
) %>%
ungroup()
model <- feols(
data = shuffled_data,
fml = Score ~ Ideology + log(Population) + log(GDPPerCapita) | State + Year,
panel.id = ~ State + Year,
vcov = "driscoll_kraay"
)
permutation_coefficients$PolicyScore[i] <- coef(model)["Ideology"]
}
options(scipen = 999)
library(tidyverse)
library(fastDummies)
library(zoo)
library(nnet)
library(plm)
set.seed(07151129)
panel <- read.csv("panel_data_FEB20.csv")
policies <- read.csv("replication/policies_updated.csv") %>% filter(year >= 1998) %>% filter(abb != "DC") %>% select(-X)
names(policies)[1:2] <- c("State", "Year")
colnames(policies)
policies_temp <- policies %>% select(-x_rps_targets_bindingonly, -z_gasoline_tax, -x_eers)
str(policies_temp)
colnames(policies_temp) <-
dplyr::recode(colnames(policies_temp),
"abb" = "State", "year" = "Year",
"climate_action_plan_21" = "ClimateActionPlan",
"netmeter_yearadopted_21" = "NetMeter",
"pace_21" = "PACE",
"w_ee_21" = "EfficiencyTargets",
"w_environment_solar_taxcredit_21" = "ResSolarTaxCredit",
"w_low_income_ee_21" = "LowIncomeEff",
"public_building_standards" = "PublicBuildingStandards",
"w4_electric_decoupling_21" = "ElectricDecoupling",
"w4_gas_decoupling_21" = "GasDecoupling",
"w_gg_rr_21" = "PowerPlantsReport",
"environment_ca_car_emissions_standards_21" = "CACarStandards",
"environment_preemption_naturalgasbans" = "ProhibitGasHookupBans",
"w4_environment_state_rps_21" = "RPS",
"w_ghg_targets_21" = "GHGTargets",
"community_solar" = "CommunitySolar",
"environment_ghg_cap_21" = "UtilitiesGHGCap",
"environment_publicbenefit_funds_21" = "PublicBenefitFunds",
"fgd_21" = "FuelSourceDisclosure",
"ghg_standards_21" = "PerformanceStandards",
"w_complete_streets_21" = "CompleteStreets",
"w_environment_state_nepas_21" = "StateNEPA",
"w_mgpo_21" = "RenewablesOffered")
carbon_intensity_policies <- c("CACarStandards", "CommunitySolar", "FuelSourceDisclosure", "NetMeter","RenewablesOffered", "RPS", "PowerPlantsReport", "ResSolarTaxCredit", "UtilitiesGHGCap", "GHGTargets")
energy_intensity_policies <- c("ProhibitGasHookupBans", "PublicBuildingStandards", "CompleteStreets", "EfficiencyTargets", "LowIncomeEff", "ElectricDecoupling", "GasDecoupling", "PerformanceStandards")
other_policies <- c("ClimateActionPlan", "PublicBenefitFunds", "PACE", "StateNEPA")
count <- policies_temp %>%
mutate(sum = rowSums(across(c(-State, -Year)), na.rm = TRUE))
count <- count %>% select(State, Year, sum)
colnames(count)[3] <- "Score"
count <- merge(count, policies %>% select(State, Year, x_rps_targets_bindingonly, z_gasoline_tax, x_eers), by = c("State", "Year"))
count <- merge(count, panel, c("State", "Year"))
## carbon intensity
CI_pol <- policies_temp %>% select(State, Year, all_of(carbon_intensity_policies)) %>%
mutate(sum = rowSums(across(c(-State, -Year)), na.rm = TRUE))
CI_pol <- CI_pol %>% select(State, Year, sum)
colnames(CI_pol)[3] <- "CI_Score"
## energy intensity
EI_pol <- policies_temp %>% select(State, Year, all_of(energy_intensity_policies)) %>%
mutate(sum = rowSums(across(c(-State, -Year)), na.rm = TRUE))
EI_pol <- EI_pol %>% select(State, Year, sum)
colnames(EI_pol)[3] <- "EE_Score"
###
other_pol <- policies_temp %>% select(State, Year, all_of(other_policies)) %>%
mutate(sum = rowSums(across(c(-State, -Year)), na.rm = TRUE))
other_pol <- other_pol %>% select(State, Year, sum)
colnames(other_pol)[3] <- "Other_Score"
###
count <- merge(count, CI_pol, by = c("State", "Year"))
count <- merge(count, EI_pol, by = c("State", "Year"))
count <- merge(count, other_pol, by = c("State", "Year"))
###
#write.csv(count, "panel_with_count_FEB20.csv", row.names = FALSE)
View(policies_temp)
table(policies_temp$NetMeter)
table(policies_temp$ResSolarTaxCredit)
table(policies_temp$ResSolarTaxCredit)
table(policies_temp$NetMeter)
table(policies_temp$ResSolarTaxCredit)
table(policies_temp$NetMeter)
table(policies_temp$PerformanceStandards)
table(policies_temp$UtilitiesGHGCap)
setwd("~/R/thesis")
options(scipen = 999)
library(tidyverse)
library(fastDummies)
library(zoo)
library(nnet)
library(plm)
set.seed(07151129)
panel <- read.csv("panel_data_FEB20.csv")
policies <- read.csv("replication/policies_updated.csv") %>% filter(year >= 1998) %>% filter(abb != "DC") %>% select(-X)
names(policies)[1:2] <- c("State", "Year")
colnames(policies)
policies_temp <- policies %>% select(-x_rps_targets_bindingonly, -z_gasoline_tax, -x_eers)
str(policies_temp)
colnames(policies_temp) <-
dplyr::recode(colnames(policies_temp),
"abb" = "State", "year" = "Year",
"climate_action_plan_21" = "ClimateActionPlan",
"netmeter_yearadopted_21" = "NetMeter",
"pace_21" = "PACE",
"w_ee_21" = "EfficiencyTargets",
"w_environment_solar_taxcredit_21" = "ResSolarTaxCredit",
"w_low_income_ee_21" = "LowIncomeEff",
"public_building_standards" = "PublicBuildingStandards",
"w4_electric_decoupling_21" = "ElectricDecoupling",
"w4_gas_decoupling_21" = "GasDecoupling",
"w_gg_rr_21" = "PowerPlantsReport",
"environment_ca_car_emissions_standards_21" = "CACarStandards",
"environment_preemption_naturalgasbans" = "ProhibitGasHookupBans",
"w4_environment_state_rps_21" = "RPS",
"w_ghg_targets_21" = "GHGTargets",
"community_solar" = "CommunitySolar",
"environment_ghg_cap_21" = "UtilitiesGHGCap",
"environment_publicbenefit_funds_21" = "PublicBenefitFunds",
"fgd_21" = "FuelSourceDisclosure",
"ghg_standards_21" = "PerformanceStandards",
"w_complete_streets_21" = "CompleteStreets",
"w_environment_state_nepas_21" = "StateNEPA",
"w_mgpo_21" = "RenewablesOffered")
carbon_intensity_policies <- c("CACarStandards", "CommunitySolar", "FuelSourceDisclosure", "NetMeter","RenewablesOffered", "RPS", "PowerPlantsReport", "ResSolarTaxCredit", "UtilitiesGHGCap", "GHGTargets")
energy_intensity_policies <- c("ProhibitGasHookupBans", "PublicBuildingStandards", "CompleteStreets", "EfficiencyTargets", "LowIncomeEff", "ElectricDecoupling", "GasDecoupling", "PerformanceStandards")
other_policies <- c("ClimateActionPlan", "PublicBenefitFunds", "PACE", "StateNEPA")
count <- policies_temp %>%
mutate(sum = rowSums(across(c(-State, -Year)), na.rm = TRUE))
count <- count %>% select(State, Year, sum)
colnames(count)[3] <- "Score"
count <- merge(count, policies %>% select(State, Year, x_rps_targets_bindingonly, z_gasoline_tax, x_eers), by = c("State", "Year"))
count <- merge(count, panel, c("State", "Year"))
## carbon intensity
CI_pol <- policies_temp %>% select(State, Year, all_of(carbon_intensity_policies)) %>%
mutate(sum = rowSums(across(c(-State, -Year)), na.rm = TRUE))
CI_pol <- CI_pol %>% select(State, Year, sum)
colnames(CI_pol)[3] <- "CI_Score"
## energy intensity
EI_pol <- policies_temp %>% select(State, Year, all_of(energy_intensity_policies)) %>%
mutate(sum = rowSums(across(c(-State, -Year)), na.rm = TRUE))
EI_pol <- EI_pol %>% select(State, Year, sum)
colnames(EI_pol)[3] <- "EE_Score"
###
other_pol <- policies_temp %>% select(State, Year, all_of(other_policies)) %>%
mutate(sum = rowSums(across(c(-State, -Year)), na.rm = TRUE))
other_pol <- other_pol %>% select(State, Year, sum)
colnames(other_pol)[3] <- "Other_Score"
###
count <- merge(count, CI_pol, by = c("State", "Year"))
count <- merge(count, EI_pol, by = c("State", "Year"))
count <- merge(count, other_pol, by = c("State", "Year"))
###
write.csv(count, "panel_with_count_FEB20.csv", row.names = FALSE)
policies_melt <- melt(policies_temp)
library(reshape2)
policies_melt <- melt(policies_temp)
View(policies_melt)
View(policies_temp)
policies_melt <- melt(policies_temp, c("State", "Year"))
View(policies_melt)
policies_melt <- melt(policies_temp, c("State", "Year"))
policies_melt <- policies_melt %>%
group_by(variable) %>%
summarise(sum_value = sum(value, na.rm = TRUE))
View(policies_melt)
ggplot(policies_melt) + geom_histogram(aes(x = variable))
View(policies_temp)
View(policies_melt)
ggplot(policies_melt) + geom_bar(aes(x = variable, sum_value), stat = "identity")
ggplot(policies_melt) + geom_bar(aes(x = variable, sum_value), stat = "identity") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
library(ggpubr)
ggplot(policies_melt) + geom_bar(aes(x = variable, sum_value), stat = "identity") + theme_pubr() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
policies_melt <- policies_melt %>%
mutate(variable = factor(variable, levels = variable[order(sum_value)]))
ggplot(policies_melt) + geom_bar(aes(x = variable, sum_value), stat = "identity") + theme_pubr() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(policies_melt) + geom_bar(aes(x = variable, sum_value), stat = "identity") + theme_pubr() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) + labs(x = "Policy", y = "Count", title = "Policy Count by State")
ggplot(policies_melt) + geom_bar(aes(x = variable, sum_value), stat = "identity") + theme_pubr() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) + labs(x = "Policy", y = "Count", title = "Policy Counts")
